{% extends "base.html" %}
{% block title %}{{ song.title }} — {{ song.artist.name }}{% endblock %}
{% block content %}
<section class="px-4 sm:px-6 lg:px-8 pt-16 sm:pt-20 pb-10">
  <div class="max-w-3xl mx-auto">
    <h1 class="text-2xl font-semibold mb-4">{{ song.title }} — {{ song.artist.name }}</h1>
    <div class="space-y-4">
      {% for line in song.lines.all %}
        <article id="L{{ line.no }}" class="bg-white/5 rounded-xl p-4 border border-white/10">
          <div class="flex items-start gap-3">
            <span class="text-white/60 text-sm w-10">#{{ line.no }}</span>
            <div class="flex-1">
              <p class="font-medium">{{ line.original }}</p>
              {% if line.romanized %}<p class="italic text-white/70">{{ line.romanized }}</p>{% endif %}
              <p class="text-emerald-400">{{ line.translation_en }}</p>
            </div>
            <button type="button" class="copylink text-xs px-2 py-1 rounded border border-white/20 hover:bg-white/10"
                    data-no="{{ line.no }}" aria-label="Copy link to line {{ line.no }}">
              Copy link
            </button>
          </div>
        </article>
      {% endfor %}
    </div>
  </div>
</section>

<script>
  function highlightFromHash() {
    if (!location.hash.startsWith('#L')) return;
    const el = document.querySelector(location.hash);
    if (!el) return;
    el.classList.add('ring-2','ring-amber-400');
    setTimeout(() => el.classList.remove('ring-2','ring-amber-400'), 1500);
  }
  highlightFromHash();
  document.querySelectorAll('.copylink').forEach(btn => {
    btn.addEventListener('click', async () => {
      const no = btn.getAttribute('data-no');
      const url = `${location.origin}${location.pathname}#L${no}`;
      try {
        await navigator.clipboard.writeText(url);
        const old = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => (btn.textContent = old), 1200);
      } catch (e) { prompt('Copy this link:', url); }
    });
  });
  window.addEventListener('hashchange', highlightFromHash);
</script>
{% endblock %}
